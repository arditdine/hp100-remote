<!DOCTYPE html>
<html>

<head>
  <title>TV Screen</title>
  <link rel="icon shortcut" href="https://www.iqair.com/dashboard/device/tv/favicon.a3fff058.ico">
  <link rel="stylesheet" href="/style.css">
</head>

<body>

  <div class="bg">
    <div class="container">
      <div class="header">
        <div class="space">
          <div class="space-name">
            <h1 id="device-name"></h1>
          </div>
        </div>
        <div class="forecast">
          <div class="forecast-datetime"> <span class="time" id="clock">00:00:00</span> <span class="date" id="date"></span> </div>
          <div class="forecast-icon active" id="weather-container"> <img alt="" class="weather-icon" id="weather-icon" src="https://www.iqair.com/assets/weather/ic-w-01-clear-sky-full.svg"> </div>
        </div>
      </div>
      <div class="main" id="content-container">
        <div class="aqi">
          <div class="aqi-card green">
            <div class="label-face">
              <span class="aqi-label">Air quality</span>
              <img src="https://www.iqair.com/dashboard/device/tv/img/ic-face-green-96-px.svg" alt="" class="aqi-face face-icon">
            </div>
            <div>
              <div class="aqi-status"></div>
              <div><span class="aqi-number"></span></div>
            </div>
          </div>
          <div class="aqi-graph">
            <div id="aqi-chart" data-highcharts-chart="3" style="overflow: hidden;">
              <div id="highcharts-o5arbyy-141" dir="ltr" class="highcharts-container " style="position: relative; overflow: hidden; width: 234px; height: 77px; text-align: left; line-height: normal; z-index: 0; -webkit-tap-highlight-color: rgba(0, 0, 0, 0); user-select: none;">
              </div>
            </div>
          </div>
        </div>
        <div class="info">
          <div class="indoor">
            <div class="pollutant">
              
            </div>
            <div class="gauge"></div>
          </div>
        </div>
      </div>
      <div class="footer"> <span class="latest-update">Last update <span id="lastUpdate"></span></span> <span
          class="powered-by">Powered by <a href="/"><img src="https://www.iqair.com/dashboard/device/tv/ic-logo-iq-air-white.7267dbca.svg" alt="IQ Air logo"
              class="footer-logo"></a> </span> </div>
    </div>
  </div>


  <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/moment.min.js"></script>
  <script src="/socket.io/socket.io.js"></script>
  <script>
      const clock = function() {
        let getDate = new Date();
        document.getElementById('clock').innerHTML = getDate.toLocaleTimeString('en-US', { hour12: false });
    }
    setInterval(function() { clock();}, 1000);

    $("#date").text(moment().format('dddd, MMMM D'));

    var getQueryStringValue = function(parameter) {
        var currentPageURL = window.location.search.substring(1);
        var queryString = currentPageURL.split('&');
        var getParameter;
        var i;
        for (i = 0; i < queryString.length; i++) {
            getParameter = queryString[i].split('=');
            if (getParameter[0] === parameter) {
                return getParameter[1] === undefined ? true : decodeURIComponent(getParameter[1]);
            }
        }
    };

    var socket = io({
        query: {
            model: getQueryStringValue("model"),
            device_id: getQueryStringValue("device_id")
        }
    });

    socket.on('measurement', function(msg){

        $('.pollutant').empty()

        
        
        if(msg.name) $("#device-name").html(msg.name.toUpperCase())
        $(".aqi-number").html(`<span class="aqi-number">${msg.aqi}<small class="aqi-type" id="aqi-type"> US AQI</small></span>`)
        $(".aqi-status").html(msg.label)
        $("#lastUpdate").text(moment(msg.ts).format("HH:mm"))


        // PM2.5
        if(msg.pm25) {
          $(".pollutant").append(`<div class="item-container">
            <div class="item">
              <span class="item-type">PM2.5<small class="measure">  µg/m³</small></span>
              <span class="item-value"><small class="aqi-circle green"></small>${msg.pm25}</span>
            </div>
          </div>`)
        }

        // CO2
        if(msg.co2) {
          $(".pollutant").append(`<div class="item-container">
            <div class="item">
              <span class="item-type">CO2<small class="measure">  ppm</small></span>
              <span class="item-value"><small class="aqi-circle green"></small>${msg.co2}</span>
            </div>
          </div>`)
        }

        // Temperature
        if(msg.temperature) {
          $(".pollutant").append(`<div class="item-container">
            <div class="item">
              <span class="item-type">Temp.</span>
              <span class="item-value"></small>${msg.temperature}°</span>
            </div>
          </div>`)
        }

        // TVOC
        if(msg.tvoc) {
          $(".pollutant").append(`<div class="item-container">
            <div class="item">
              <span class="item-type">TVOC<small class="measure">  ppm</small></span>
              <span class="item-value"><small class="aqi-circle ${msg.tvoc.color}"></small>${msg.tvoc.conc}</span>
            </div>
          </div>`)
        }

        // Humidity
        if(msg.humidity) {
          $(".pollutant").append(`<div class="item-container">
            <div class="item">
              <span class="item-type">Humid.</span>
              <span class="item-value"></small>${msg.humidity}%</span>
            </div>
          </div>`)
        }

        // HCHO
        if(msg.hcho) {
          $(".pollutant").append(`<div class="item-container">
            <div class="item">
              <span class="item-type">HCHO<small class="measure">  ppm</small></span>
              <span class="item-value"><small class="aqi-circle ${msg.hcho.color}"></small>${msg.hcho.conc}</span>
            </div>
          </div>`)
        }

        $(".pollutant").append('<div class="hide-border"></div>')
    });
  </script>
</body>

</html>